{"version":3,"file":"savedraft.min.js","sources":["../src/savedraft.js"],"sourcesContent":["define(['jquery'], function($) {\n    return {\n        init: function (speid, sesskey) {\n            const COOLDOWN = 5 * 1000; \n            let timeout;\n            const form = $('.mform'); \n            const lastSavedSpan = $('#draft-last-saved');\n            console.log(\"Auto-save draft initialized for SPE ID:\", speid);\n            form.on('input change', function () {\n                clearTimeout(timeout);\n                timeout = setTimeout(() => {\n                    console.log(\"Auto-saving draft...\");\n                    const data = form.serialize();\n\n                    $.post(M.cfg.wwwroot + '/mod/smartspe/student/savedraft.php', {\n                        speid: speid,\n                        sesskey: sesskey,\n                        data: data\n                    })\n                    .done(function (response) {\n                        console.log('Draft saved');\n                        const json = JSON.parse(response);\n                        const now = new Date().toLocaleTimeString();\n                        if (json.status === 'ok') {\n                            console.log(json)\n                            lastSavedSpan.text('Last saved at ' + now);\n                            lastSavedSpan.css('color', 'green');\n                        } else {\n                            console.error('Save error:', json.message);\n                            lastSavedSpan.text('Save failed at ' + now);\n                            lastSavedSpan.css('color', 'red');\n                        }\n                        \n                    })\n                    .fail(function(xhr) {\n                        console.error('Save failed:', xhr.responseText);\n                    });\n                }, COOLDOWN); // Save every COOLDOWN seconds after idle\n            });\n        }\n    };\n});\n"],"names":["define","$","init","speid","sesskey","timeout","form","lastSavedSpan","console","log","on","clearTimeout","setTimeout","data","serialize","post","M","cfg","wwwroot","done","response","json","JSON","parse","now","Date","toLocaleTimeString","status","text","css","error","message","fail","xhr","responseText"],"mappings":"AAAAA,gCAAO,CAAC,WAAW,SAASC,SACjB,CACHC,KAAM,SAAUC,MAAOC,aAEfC,cACEC,KAAOL,EAAE,UACTM,cAAgBN,EAAE,qBACxBO,QAAQC,IAAI,0CAA2CN,OACvDG,KAAKI,GAAG,gBAAgB,WACpBC,aAAaN,SACbA,QAAUO,YAAW,KACjBJ,QAAQC,IAAI,8BACNI,KAAOP,KAAKQ,YAElBb,EAAEc,KAAKC,EAAEC,IAAIC,QAAU,sCAAuC,CAC1Df,MAAOA,MACPC,QAASA,QACTS,KAAMA,OAETM,MAAK,SAAUC,UACZZ,QAAQC,IAAI,qBACNY,KAAOC,KAAKC,MAAMH,UAClBI,KAAM,IAAIC,MAAOC,qBACH,OAAhBL,KAAKM,QACLnB,QAAQC,IAAIY,MACZd,cAAcqB,KAAK,iBAAmBJ,KACtCjB,cAAcsB,IAAI,QAAS,WAE3BrB,QAAQsB,MAAM,cAAeT,KAAKU,SAClCxB,cAAcqB,KAAK,kBAAoBJ,KACvCjB,cAAcsB,IAAI,QAAS,WAIlCG,MAAK,SAASC,KACXzB,QAAQsB,MAAM,eAAgBG,IAAIC,mBAhC7B"}